      body.light .company-form .logo-preview-wrap{ border-color:#e5e7eb; background:#ffffff; }
      .company-form #logoPreview{ width:100%; height:100%; object-fit:contain; display:block; }
      @media (max-width: 980px){
        .company-form .form-grid.compact { grid-template-columns: 1fr; }
        .company-form .form-grid.compact .col-1{ grid-column:1; }
        .company-form .form-grid.compact .col-2{ grid-column:1; }
        .company-form .form-grid.compact .logo-cell{ grid-column: 1; grid-row: auto; }
      }
    `;
    document.head.appendChild(st);
  }

  // Upload and preview logo on change
  const logoInput = document.getElementById('logoFile');
  const logoPreview = document.getElementById('logoPreview');
  const logoHidden = document.getElementById('f_logotipo');
  const logoPickBtn = document.getElementById('logoPickBtn');
  const logoFileName = document.getElementById('logoFileName');
  logoPickBtn?.addEventListener('click', ()=> logoInput?.click());
  logoInput?.addEventListener('change', async () => {
    const file = logoInput.files && logoInput.files[0];
    if (!file) return;
    try {
      const fd = new FormData();
      fd.append('file', file);
      const resp = await API.apiUpload('/company/logo', fd);
      const url = resp && resp.logotipo ? resp.logotipo : '';
      if (url) {
        logoHidden.value = url;
        logoPreview.src = url;
        logoPreview.style.display = '';
      }
      if (logoFileName) logoFileName.textContent = file.name || 'Archivo seleccionado';
    } catch (e) {
      if (window.showAlert) window.showAlert('Error al subir el logotipo'); else alert('Error al subir el logotipo');
    }
  });

  document.getElementById('saveCompany')?.addEventListener('click', async (ev)=>{
    ev.preventDefault();
    const obj={};
    [...fields, 'logotipo'].forEach(f=>{ const el = document.getElementById(`f_${f}`); if (el) obj[f] = el.value; });
    await API.apiPut('/company', obj);
    try {
      const makeToast = (msg)=>{
        const n = document.createElement('div');
        n.className = 'center-toast success';
        n.textContent = msg;
        document.body.appendChild(n);
        setTimeout(()=> n.classList.add('hide'), 1400);
        setTimeout(()=> { try { n.remove(); } catch(_){} }, 1800);
      };
      makeToast('Guardado exitosamente');
    } catch(_) { try { alert('Guardado exitosamente'); } catch(__){} }
  });
}

async function loadVariables() {
  const data = await API.apiGet('/variables');
  const keys = ['variable_prov1','variable_prov2','variable_prov3'];
  const labels = ['Variable1','Variable2','Variable3'];
